
@{
    ViewBag.Title = "Forum";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles
{
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    @Styles.Render("~/bundles/HelpForumStyles")
}

<div id="divForumWrapper" class="col-md-12 no-padding-left no-padding-right">
    <div id="divCategories">
        <ul class="nav nav-pills nav-justified">
            <li role="presentation" data-bind="css:{active: selections.categoryId() == 0}, click:function(){selections.categoryId(0); resetAndGetPosts();}"><a href="#"><i class="fa fa-globe icon-font icon-category"></i> ALL</a></li>
            <li role="presentation" data-bind="css:{active: selections.categoryId() == 1}, click:function(){selections.categoryId(1); resetAndGetPosts();}"><a href="#"><i class="fa fa-bug icon-font"></i> BUGS</a></li>
            <li role="presentation" data-bind="css:{active: selections.categoryId() == 2}, click:function(){selections.categoryId(2); resetAndGetPosts();}"><a href="#"><i class="fa fa-lightbulb-o icon-font"></i> IDEAS</a></li>
            <li role="presentation" data-bind="css:{active: selections.categoryId() == 3}, click:function(){selections.categoryId(3); resetAndGetPosts();}"><a href="#"><i class="fa fa-question icon-font"></i> HELP</a></li>
        </ul>
    </div>
    <div class="col-md-12 no-padding-left no-padding-right custom-margin-top-10">
        <div class="col-md-5 no-padding-right">
            <div id="divForumQuestions">
                <div class="row" id="divSearch">
                    <div class="col-md-6">
                        <div class="input-group category-list-search">
                            <input type="text" data-bind="value:selections.wildcard" class="form-control" placeholder="search...">
                            <div class="input-group-btn">
                                <div class="btn btn-default" data-bind="click:function(){getPosts();}">
                                    <i class="fa fa-search icon-font"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 no-padding-left">
                        <div class="col-md-8 no-padding-left no-padding-right">
                            <div class="form-group">
                                <select class="form-control" data-bind="value: selections.statusId, valueUpdate: 'change, keyup', event:{change: function(){getPosts();}}">
                                    <option value="0">All</option>
                                    <option value="1">New</option>
                                    <option value="2">In Disucssion</option>
                                    <option value="3">In Progress</option>
                                    <option value="4">Closed</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid" id="divPosts">
                    <div data-bind="foreach: posts.DisplayPosts">
                        <div class="desc" data-bind="css:{descActive: $parent.selections.postId() == PostId}">
                            <div class="col-md-2 no-padding-left">
                                <div class="thumb">
                                    <img class="img-circle" data-bind="attr: { src: $parent.photoUrl(AddedByUser.ProfilePictureName) }" width="35px" height="35px" align="">
                                </div>
                                <div style="width: 50%; margin: 0 auto;">
                                    <span class="label label-danger" data-bind="text: Status.Title, visible: StatusId == 1"></span>
                                    <span class="label label-info" data-bind="text: Status.Title, visible: StatusId == 2"></span>
                                    <span class="label label-success" data-bind="text: Status.Title, visible: StatusId == 3"></span>
                                    <span class="label label-default" data-bind="text: Status.Title, visible: StatusId == 4"></span>
                                </div>
                            </div>
                            <div class="col-md-10">
                                <h4><a href="#" data-bind="text: Title, click:function(){$parent.getPost(PostId);}"></a></h4>
                                <p>
                                    <a href="#" data-bind="text: AddedByUser.FirstName"></a> posted
                                    <i class="fa fa-bug icon-font" data-bind="visible: CategoryId == 1"></i>
                                    <i class="fa fa-lightbulb-o icon-font" data-bind="visible: CategoryId == 2"></i>
                                    <i class="fa fa-question icon-font" data-bind="visible: CategoryId == 3"></i>
                                    <span data-bind="text: Category.Title"></span>
                                    <span data-bind="text: moment(CreatedOn).format('MMMM Do YYYY, h:mm a')"></span><br />
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="divPager">
                    <nav aria-label="..." data-bind="visible: posts.PageCount() > 1">
                        <ul class="pager">
                            <li class="previous" data-bind="visible: posts.CurrentPage() > 1, click:function(){getPreviousPage();}"><a href="#"><span aria-hidden="true">&larr;</span> Previous</a></li>
                            <li class="next" data-bind="visible: posts.CurrentPage() != posts.PageCount(), click:function(){getNextPage();}"><a href="#">Next <span aria-hidden="true">&rarr;</span></a></li>
                        </ul>
                    </nav>
                </div>

            </div>
        </div>
        <div class="col-md-7">
            <div id="divForumPost">
                <div class="row">
                    <div class="col-md-offset-8 col-md-4">
                        <button type="button" class="btn btn-info"
                                data-bind="click:function(){selections.newPostPanelShow(true);}">
                            <i class="fa fa-plus icon-font"></i> Ask Your Question
                        </button>
                    </div>
                </div>
                <div id="divNewPost" data-bind="visible: selections.newPostPanelShow() === true">
                    <div class="alert alert-danger" data-bind="visible: alerts.postValidation() != ''">
                        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                        <div data-bind="text:alerts.postValidation"></div>
                    </div>
                    <div class="alert alert-success" data-bind="visible: alerts.postAddedSuccess() != ''">
                        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                        <div data-bind="text:alerts.postAddedSuccess"></div>
                    </div>
                    <div>
                        <h3>Post your Question</h3>
                    </div>
                    <form class="form-horizontal">
                        <div class="form-group">
                            <label class="control-label col-sm-2">Title :</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" placeholder="type your title"
                                       data-bind="value:newPost.Title">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">Description :</label>
                            <div class="col-sm-8">
                                <textarea class="form-control" rows="5" id="ckeditorPost" data-bind="CKEDITOR: newPost.Description, autoResizeTextArea: true"></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-sm-2">Category :</label>
                            <div class="col-sm-4">
                                <select class="form-control" data-bind="value: newPost.CategoryId, valueUpdate: 'change, keyup'">
                                    <option value="1">Bug</option>
                                    <option value="2">Idea</option>
                                    <option value="3">Help</option>
                                </select>
                            </div>
                        </div>
                        <button type="button"
                                data-bind="click: function(){selections.newPostPanelShow(false);}"
                                class="btn btn-primary">
                            Cancel
                        </button>
                        <button type="button"
                                data-bind="click: validateAndAddPost"
                                class="btn btn-primary">
                            Submit
                        </button>
                    </form>
                </div>
                <div id="divPostContent" data-bind="visible: selections.newPostPanelShow() === false && selections.postId() != 0">
                    <div>
                        <h1 data-bind="text: selections.post.Title()"></h1>
                        <p><i class="fa fa-bug icon-font" data-bind="visible: selections.post.CategoryId() == 1"></i>
                            <i class="fa fa-lightbulb-o icon-font" data-bind="visible: selections.post.CategoryId() == 2"></i>
                            <i class="fa fa-question icon-font" data-bind="visible: selections.post.CategoryId() == 3"></i>
                            By :<a href="#" data-bind="text:selections.post.AddedByUser()"></a>
                            <span data-bind="text: moment(selections.post.CreatedOn()).format('MMMM Do YYYY, h:mm a')"></span><br />
                        </p>
                    </div>
                    <br />
                    <p data-bind="html: selections.post.Description()"></p>
                    <br />
                    <div data-bind="foreach: selections.post.Threads">
                        <div class="desc">
                            <div class="col-md-2 no-padding-left">
                                <div class="thumb">
                                    <img class="img-circle" data-bind="attr: { src: $parent.photoUrl(AddedByUser.ProfilePictureName) }" width="35px" height="35px" align="">
                                </div>
                                <div>
                                    <a href="#" data-bind="text: AddedByUser.FirstName + ' ' +  AddedByUser.LastName"></a>
                                </div>
                            </div>
                            <div class="col-md-10">
                                <div data-bind="html: Description"></div>
                            </div>
                            <hr/>
                        </div>
                    </div>
                    <div  data-bind="visible: selections.postId() != 0">
                        <form class="form-horizontal">
                            <div class="form-group">
                                <label class="control-label col-sm-2">Change Status </label>
                                <div class="col-sm-10">
                                    <div class="btn-group">
                                        <button type="button" class="label label-danger" data-bind="visible:selections.post.StatusId() < 1, click:updatePostStatus(1)">New</button>
                                        <button type="button" class="label label-info" data-bind="visible: selections.post.StatusId() == 1 || selections.post.StatusId() == 3, click:updatePostStatus(2)">In Discussion</button>
                                        <button type="button" class="label label-success" data-bind="visible:selections.post.StatusId() == 1 || selections.post.StatusId() == 2, click:updatePostStatus(3)">In Progress</button>
                                        <button type="button" class="label label-default" data-bind="visible:selections.post.StatusId() != 4, click:updatePostStatus(4)">Closed</button>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2">Comment </label>
                                <div class="col-sm-8">
                                    <textarea class="form-control" rows="5" id="ckeditorThread" data-bind="CKEDITOR: newPostThread.Description, autoResizeTextArea: true"></textarea>
                                </div>
                                <div>
                                    <button type="button"
                                            data-bind="click: addPostThread, enable: newPostThread.Description().trim() != ''"
                                            class="btn btn-primary">
                                        Submit
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts
{
    <script src="~/Scripts/ckeditor/ckeditor.js"></script>
    @Scripts.Render("~/bundles/HelpForumScripts")
}